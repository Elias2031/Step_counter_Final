{"version":3,"sources":["Credentials.js"],"names":["async","metadata","fetchCredentials","credentialsExistForPlatformAsync","getCredentialsForPlatform","username","experienceName","bundleIdentifier","platform","decrypt","err","credentials","await","Api","callMethodAsync","Error","newCredentials","updateCredentialsForPlatform","removeCredentialsForPlatform","appleTeamId","certs","map","usedByApps","rest","split","getExistingDistCerts"],"mappings":";;;;;;;;;;+BA6COA,WACLC,QADKD,EAEkB;AACvB,WAAOE,iBAAiBD,QAAjBC,EAA2B,KAA3BA,CAAP;AACF,G;;kBAJsBC,gC;;;;;;gCAMfH,WACLC,QADKD,EAEkB;AACvB,WAAOE,iBAAiBD,QAAjBC,EAA2B,IAA3BA,CAAP;AACF,G;;kBAJsBE,yB;;;;;;gCAMtBJ,WACE,EAAEK,QAAF,EAAYC,cAAZ,EAA4BC,gBAA5B,EAA8CC,QAA9C,EADFR,EAEES,OAFFT,EAGyB;AACvB;AACA,UAAM,EAAEU,GAAF,EAAOC,WAAP,KAAuBC,MAAMC,8BAAIC,eAAJD,CAAoB,gBAApBA,EAAsC,EAAtCA,EAA0C,MAA1CA,EAAkD;AACnFR,cADmF;AAEnFC,oBAFmF;AAGnFC,sBAHmF;AAInFC,cAJmF;AAKnFC;AALmF,KAAlDI,CAAnC;;AAQA,QAAIH,GAAJ,EAAS;AACP,YAAM,IAAIK,KAAJ,CAAU,6BAAV,CAAN;AACF;;AAEA,WAAOJ,WAAP;AACF,G;;kBAlBeT,gB;;;;;;gCAoBRF,WACLQ,QADKR,EAELgB,cAFKhB,EAGLC,QAHKD,EAIU;AACf;AACA,UAAM,EAAEU,GAAF,EAAOC,WAAP,KAAuBC,MAAMC,8BAAIC,eAAJD,CAAoB,mBAApBA,EAAyC,EAAzCA,EAA6C,MAA7CA;AACjCF,mBAAaK,cADoBH;AAEjCL;AAFiCK,OAG9BZ,QAH8BY,EAAnC;;AAMA,QAAIH,OAAO,CAACC,WAAZ,EAAyB;AACvB,YAAM,IAAII,KAAJ,CAAU,6BAAV,CAAN;AACF;AACF,G;;kBAfsBE,4B;;;;;;gCAiBfjB,WACLQ,QADKR,EAELC,QAFKD,EAGU;AACf;AACA,UAAM,EAAEU,GAAF,KAAUE,MAAMC,8BAAIC,eAAJD,CAAoB,mBAApBA,EAAyC,EAAzCA,EAA6C,MAA7CA;AACpBL;AADoBK,OAEjBZ,QAFiBY,EAAtB;;AAKA,QAAIH,GAAJ,EAAS;AACP,YAAM,IAAIK,KAAJ,CAAU,6BAAV,CAAN;AACF;AACF,G;;kBAbsBG,4B;;;;;;gCAeflB,WACLK,QADKL,EAELmB,WAFKnB,EAGgB;AACrB,UAAM,EAAEU,GAAF,EAAOU,KAAP,KAAiBR,MAAMC,8BAAIC,eAAJD,CAAoB,sBAApBA,EAA4C,EAA5CA,EAAgD,MAAhDA,EAAwD;AACnFR,cADmF;AAEnFc;AAFmF,KAAxDN,CAA7B;;AAKA,QAAIH,GAAJ,EAAS;AACP,YAAM,IAAIK,KAAJ,CAAU,mDAAV,CAAN;AACF;;AAEA,WAAOK,MAAMC,GAAND,CAAU;AAAA,UAAC,EAAEE,UAAF,EAAD;AAAA,UAAkBC,IAAlB;;AAAA;AACfD,oBAAYA,cAAcA,WAAWE,KAAXF,CAAiB,GAAjBA;AADX,SAEZC,IAFY;AAAA,KAAVH,CAAP;AAIF,G;;kBAjBsBK,oB;;;;;;;AAzGtB;AAAA;AAAA","file":"../Credentials.js","sourcesContent":["/**\n * @flow\n */\n\nimport Api from './Api';\n\nexport type AndroidCredentials = {\n  keystore: string,\n  keystoreAlias: string,\n  keystorePassword: string,\n  keyPassword: string,\n};\n\nexport type IOSCredentials = {\n  appleId?: string,\n  password?: string,\n  teamId?: string,\n  certP12?: string,\n  certPassword?: string,\n  pushP12?: string,\n  pushPassword?: string,\n  provisioningProfile?: string,\n  enterpriseAccount?: string,\n  // These are ids on the spaceship object (implementation detail), Spaceship::Portal::Certificate\n  certId?: string,\n  pushId?: string,\n  provisioningProfileId?: string,\n};\n\nexport type Credentials = IOSCredentials | AndroidCredentials;\n\nexport type CredentialMetadata = {\n  username: string,\n  experienceName: string,\n  bundleIdentifier: string,\n  platform: string,\n};\n\nexport type CertObject = {\n  userCredentialId: number,\n  certId: string,\n};\n\nexport type CertsList = Array<CertObject>;\n\nexport async function credentialsExistForPlatformAsync(\n  metadata: CredentialMetadata\n): Promise<?Credentials> {\n  return fetchCredentials(metadata, false);\n}\n\nexport async function getCredentialsForPlatform(\n  metadata: CredentialMetadata\n): Promise<?Credentials> {\n  return fetchCredentials(metadata, true);\n}\n\nasync function fetchCredentials(\n  { username, experienceName, bundleIdentifier, platform }: CredentialMetadata,\n  decrypt: boolean\n): Promise<?Credentials> {\n  // this doesn't hit our mac rpc channel, so it needs significantly less debugging\n  const { err, credentials } = await Api.callMethodAsync('getCredentials', [], 'post', {\n    username,\n    experienceName,\n    bundleIdentifier,\n    platform,\n    decrypt,\n  });\n\n  if (err) {\n    throw new Error('Error fetching credentials.');\n  }\n\n  return credentials;\n}\n\nexport async function updateCredentialsForPlatform(\n  platform: string,\n  newCredentials: Credentials,\n  metadata: CredentialMetadata\n): Promise<void> {\n  // this doesn't go through the mac rpc, no request id needed\n  const { err, credentials } = await Api.callMethodAsync('updateCredentials', [], 'post', {\n    credentials: newCredentials,\n    platform,\n    ...metadata,\n  });\n\n  if (err || !credentials) {\n    throw new Error('Error updating credentials.');\n  }\n}\n\nexport async function removeCredentialsForPlatform(\n  platform: string,\n  metadata: CredentialMetadata\n): Promise<void> {\n  // doesn't go through mac rpc, no request id needed\n  const { err } = await Api.callMethodAsync('deleteCredentials', [], 'post', {\n    platform,\n    ...metadata,\n  });\n\n  if (err) {\n    throw new Error('Error deleting credentials.');\n  }\n}\n\nexport async function getExistingDistCerts(\n  username: string,\n  appleTeamId: string\n): Promise<?CertsList> {\n  const { err, certs } = await Api.callMethodAsync('getExistingDistCerts', [], 'post', {\n    username,\n    appleTeamId,\n  });\n\n  if (err) {\n    throw new Error('Error getting existing distribution certificates.');\n  }\n\n  return certs.map(({ usedByApps, ...rest }) => ({\n    usedByApps: usedByApps && usedByApps.split(';'),\n    ...rest,\n  }));\n}\n"],"sourceRoot":"/xdl@50.0.0/src"}